<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG Training Tools - Interactive Demonstrations</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>
    <style>
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-button.active {
            background-color: #d14c6b;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { Sliders, Target, DollarSign, TrendingUp, Lightbulb, Play, RotateCcw, Search, Zap, Database, Brain, MessageSquare, ChevronRight, Eye, EyeOff } = lucide;

        // TOP-K SIMULATOR COMPONENT
        function TopKSimulator() {
            const [kValue, setKValue] = useState(5);
            const [selectedQuestion, setSelectedQuestion] = useState('simple');
            const [retrievedPassages, setRetrievedPassages] = useState([]);
            const [llmResponse, setLlmResponse] = useState('');
            const [metrics, setMetrics] = useState({});
            const [sweetSpot, setSweetSpot] = useState({});

            // HR Knowledge Base
            const knowledgeBase = [
                {
                    id: 1,
                    content: "Full-time employees are entitled to 4 working days of exceptional leave for their wedding. This duration is reduced to 2 days for part-time employees working less than 20 hours per week.",
                    relevanceScore: 0.94,
                    category: "direct"
                },
                {
                    id: 2,
                    content: "To qualify for marriage leave, employees must provide official documentation (marriage certificate or certificate of publication of banns) to HR at least 15 days before the planned date.",
                    relevanceScore: 0.89,
                    category: "direct"
                },
                {
                    id: 3,
                    content: "Marriage leave can be taken within a 30-day period before or after the ceremony. It must be taken all at once and cannot be split into separate periods.",
                    relevanceScore: 0.87,
                    category: "direct"
                },
                {
                    id: 4,
                    content: "Exceptional leave for marriage is fully paid and is not deducted from the employee's annual paid vacation leave balance.",
                    relevanceScore: 0.85,
                    category: "direct"
                },
                {
                    id: 5,
                    content: "In case of a dependent child's marriage, employees may benefit from 1 day of unpaid exceptional leave, subject to 7 days advance notice.",
                    relevanceScore: 0.72,
                    category: "related"
                },
                {
                    id: 6,
                    content: "Leave for family events also includes 3 days for birth/adoption, 2 days for death of a close relative, and 1 day for moving house.",
                    relevanceScore: 0.68,
                    category: "related"
                },
                {
                    id: 7,
                    content: "Any exceptional leave request must be validated by the direct manager and submitted to HR via the intranet portal or by email to hr@company.com.",
                    relevanceScore: 0.65,
                    category: "related"
                },
                {
                    id: 8,
                    content: "The remote work policy allows up to 2 days per week from home, subject to adequate equipment and managerial agreement.",
                    relevanceScore: 0.45,
                    category: "noise"
                },
                {
                    id: 9,
                    content: "Paid vacation is accrued at a rate of 2.5 days per month worked. The balance can be checked on the personal space of the HR portal.",
                    relevanceScore: 0.42,
                    category: "noise"
                },
                {
                    id: 10,
                    content: "The company parking lot has 150 spaces. Spaces are allocated based on seniority and hierarchical level.",
                    relevanceScore: 0.22,
                    category: "irrelevant"
                }
            ];

            // Question types
            const questionTypes = {
                simple: {
                    question: "How many days off do I get for my wedding?",
                    optimalK: 4,
                    description: "Simple factual question"
                },
                conditional: {
                    question: "Can part-time employees get marriage leave?",
                    optimalK: 3,
                    description: "Conditional specific question"
                },
                ambiguous: {
                    question: "What leave am I entitled to for family events?",
                    optimalK: 6,
                    description: "Ambiguous question requiring more context"
                }
            };

            // Generate responses
            const generateLLMResponse = (passages, k, questionType) => {
                const directPassages = passages.filter(p => p.category === 'direct').length;
                
                if (questionType === 'simple') {
                    if (k <= 2) {
                        return directPassages >= 1 
                            ? "Based on company policy, full-time employees get 4 days of marriage leave."
                            : "I don't have enough information to provide a complete answer.";
                    } else if (k <= 5) {
                        return "Full-time employees are entitled to 4 working days of exceptional leave for their wedding. Part-time employees (less than 20h/week) get 2 days. This leave is fully paid.";
                    } else {
                        return "Full-time employees receive 4 working days of paid marriage leave, while part-time employees get 2 days. Documentation required 15 days in advance, must be taken within 30 days of ceremony.";
                    }
                }
                
                if (questionType === 'conditional') {
                    if (k <= 2) {
                        return "Yes, part-time employees can get marriage leave, but with reduced duration.";
                    } else {
                        return "Yes, part-time employees working less than 20 hours per week are entitled to 2 days of marriage leave, compared to 4 days for full-time employees.";
                    }
                }
                
                // ambiguous
                if (k <= 3) {
                    return "For family events, you may be entitled to marriage leave and other family-related leave depending on the specific event.";
                } else {
                    return "Family event leave includes: Marriage (4 days full-time, 2 days part-time), birth/adoption (3 days), death of close relative (2 days), moving house (1 day). All require documentation and manager approval.";
                }
            };

            // Calculate metrics
            const calculateMetrics = (passages) => {
                const avgRelevance = passages.reduce((sum, p) => sum + p.relevanceScore, 0) / passages.length;
                const contextLength = passages.reduce((sum, p) => sum + p.content.length, 0);
                const tokenCount = Math.round(contextLength / 4) + 50;
                const cost = (tokenCount / 1000) * 0.002;
                
                const directPassages = passages.filter(p => p.category === 'direct').length;
                const noisePassages = passages.filter(p => p.category === 'noise' || p.category === 'irrelevant').length;
                
                return {
                    relevanceScore: avgRelevance,
                    cost: cost,
                    tokenCount: tokenCount,
                    directPassages: directPassages,
                    noisePassages: noisePassages
                };
            };

            // Sweet spot analysis
            const getSweetSpotAnalysis = (k, optimalK) => {
                const difference = Math.abs(k - optimalK);
                
                if (difference === 0) {
                    return { message: 'Perfect! This K value offers the best balance.' };
                } else if (difference <= 1) {
                    return { message: 'Very good choice. Close to optimal.' };
                } else if (k < optimalK - 1) {
                    return { message: 'Too few passages - risk of incomplete information.' };
                } else {
                    return { message: 'Too many passages - introduces noise and unnecessary cost.' };
                }
            };

            useEffect(() => {
                const question = questionTypes[selectedQuestion];
                const sortedPassages = [...knowledgeBase].sort((a, b) => b.relevanceScore - a.relevanceScore);
                const topK = sortedPassages.slice(0, kValue);
                
                setRetrievedPassages(topK);
                setLlmResponse(generateLLMResponse(topK, kValue, selectedQuestion));
                setMetrics(calculateMetrics(topK));
                setSweetSpot(getSweetSpotAnalysis(kValue, question.optimalK));
            }, [kValue, selectedQuestion]);

            return (
                <div className="w-full min-h-screen bg-gray-50 p-4">
                    <div className="max-w-6xl mx-auto">
                        <div className="text-center mb-6">
                            <h2 className="text-2xl font-bold mb-2 text-blue-900">Top-K Parameter Simulator for RAG</h2>
                            <p className="text-blue-800">Understand how the number of retrieved passages affects performance</p>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6 border-t-4 border-pink-600">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h3 className="text-lg font-semibold mb-4 flex items-center text-blue-900">
                                        <Target className="mr-2 text-pink-600" />
                                        Question Type
                                    </h3>
                                    <div className="space-y-3">
                                        {Object.entries(questionTypes).map(([key, q]) => (
                                            <div key={key} className="border-2 border-blue-200 rounded-lg p-3">
                                                <label className="flex items-center cursor-pointer">
                                                    <input
                                                        type="radio"
                                                        name="question"
                                                        checked={selectedQuestion === key}
                                                        onChange={() => setSelectedQuestion(key)}
                                                        className="mr-3"
                                                    />
                                                    <div>
                                                        <div className="font-medium text-blue-900">{q.description}</div>
                                                        <div className="text-sm text-blue-700">"{q.question}"</div>
                                                        <div className="text-xs text-pink-600">Optimal K: {q.optimalK}</div>
                                                    </div>
                                                </label>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div>
                                    <h3 className="text-lg font-semibold mb-4 flex items-center text-blue-900">
                                        <Sliders className="mr-2 text-pink-600" />
                                        Top-K Parameter
                                    </h3>
                                    <div className="space-y-4">
                                        <div>
                                            <div className="flex justify-between items-center mb-2">
                                                <span className="text-sm font-medium text-blue-900">Number of passages:</span>
                                                <span className="text-xl font-bold text-pink-600">K = {kValue}</span>
                                            </div>
                                            <input
                                                type="range"
                                                min="1"
                                                max="10"
                                                value={kValue}
                                                onChange={(e) => setKValue(parseInt(e.target.value))}
                                                className="w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer"
                                            />
                                            <div className="flex justify-between text-xs mt-1 text-blue-700">
                                                <span>1</span>
                                                <span>5</span>
                                                <span>10</span>
                                            </div>
                                        </div>

                                        <div className="bg-blue-100 p-4 rounded-lg">
                                            <div className="flex items-center">
                                                <Lightbulb className="w-5 h-5 mr-2 text-pink-600" />
                                                <div>
                                                    <div className="font-medium text-blue-900">Analysis</div>
                                                    <div className="text-sm text-blue-800">{sweetSpot.message}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div className="bg-white rounded-lg shadow-lg p-6 border-t-4 border-pink-600">
                                <h3 className="text-lg font-semibold mb-4 text-blue-900">
                                    Retrieved Passages (Top {kValue})
                                </h3>
                                <div className="space-y-3 max-h-80 overflow-y-auto">
                                    {retrievedPassages.map((passage, index) => (
                                        <div 
                                            key={passage.id} 
                                            className={`p-3 rounded-lg border-l-4 ${
                                                passage.category === 'direct' 
                                                    ? 'border-pink-600 bg-blue-50' 
                                                    : 'border-blue-300 bg-gray-50'
                                            }`}
                                        >
                                            <div className="flex justify-between items-start mb-2">
                                                <span className="text-sm font-semibold text-blue-900">#{index + 1}</span>
                                                <div className="text-right">
                                                    <div className="text-sm font-bold text-pink-600">
                                                        {passage.relevanceScore.toFixed(3)}
                                                    </div>
                                                    <div className="text-xs text-blue-700 capitalize">
                                                        {passage.category}
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="text-sm text-blue-900">
                                                {passage.content}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="space-y-6">
                                <div className="bg-white rounded-lg shadow-lg p-6 border-t-4 border-pink-600">
                                    <h3 className="text-lg font-semibold mb-4 text-blue-900">Generated Response</h3>
                                    <div className="bg-blue-50 p-4 rounded-lg">
                                        <div className="text-sm font-medium mb-2 text-blue-800">
                                            Question: "{questionTypes[selectedQuestion].question}"
                                        </div>
                                        <div className="text-blue-900">{llmResponse}</div>
                                    </div>
                                </div>

                                <div className="bg-white rounded-lg shadow-lg p-6 border-t-4 border-pink-600">
                                    <h3 className="text-lg font-semibold mb-4 text-blue-900">Metrics</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="bg-blue-50 p-4 rounded-lg">
                                            <div className="flex items-center mb-2">
                                                <TrendingUp className="w-4 h-4 mr-2 text-pink-600" />
                                                <span className="text-sm font-medium text-blue-900">Relevance</span>
                                            </div>
                                            <div className="text-xl font-bold text-pink-600">
                                                {metrics.relevanceScore?.toFixed(3)}
                                            </div>
                                        </div>

                                        <div className="bg-blue-50 p-4 rounded-lg">
                                            <div className="flex items-center mb-2">
                                                <DollarSign className="w-4 h-4 mr-2 text-pink-600" />
                                                <span className="text-sm font-medium text-blue-900">Cost</span>
                                            </div>
                                            <div className="text-xl font-bold text-pink-600">
                                                ${metrics.cost?.toFixed(4)}
                                            </div>
                                        </div>

                                        <div className="bg-blue-50 p-4 rounded-lg">
                                            <div className="text-sm font-medium text-blue-900">Signal</div>
                                            <div className="text-lg font-bold text-pink-600">
                                                {metrics.directPassages}/{kValue}
                                            </div>
                                        </div>

                                        <div className="bg-blue-50 p-4 rounded-lg">
                                            <div className="text-sm font-medium text-blue-900">Noise</div>
                                            <div className="text-lg font-bold text-pink-600">
                                                {metrics.noisePassages}/{kValue}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // VECTOR SIMILARITY 2D COMPONENT
        function VectorSimilarity2D() {
            const canvasRef = useRef(null);
            const [selectedPoint, setSelectedPoint] = useState(null);
            const [selectedQuery, setSelectedQuery] = useState('marriage');

            const queries = {
                marriage: { text: "marriage leave policy", pos: { x: 200, y: 150 }, color: '#d14c6b' },
                vacation: { text: "vacation policy", pos: { x: 300, y: 200 }, color: '#3b82f6' },
                remote: { text: "remote work policy", pos: { x: 150, y: 250 }, color: '#10b981' }
            };

            const documents = [
                { id: 1, text: "4 days marriage leave for full-time employees", pos: { x: 220, y: 130 }, similarity: 0.94 },
                { id: 2, text: "marriage documentation required 15 days advance", pos: { x: 240, y: 170 }, similarity: 0.89 },
                { id: 3, text: "annual vacation 2.5 days per month", pos: { x: 320, y: 180 }, similarity: 0.23 },
                { id: 4, text: "remote work 2 days per week maximum", pos: { x: 130, y: 270 }, similarity: 0.12 },
                { id: 5, text: "parking lot has 150 spaces available", pos: { x: 400, y: 300 }, similarity: 0.05 }
            ];

            useEffect(() => {
                if (!canvasRef.current) return;
                
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw grid
                ctx.strokeStyle = '#f3f4f6';
                ctx.lineWidth = 1;
                for (let i = 0; i <= canvas.width; i += 20) {
                    ctx.beginPath();
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i, canvas.height);
                    ctx.stroke();
                }
                for (let i = 0; i <= canvas.height; i += 20) {
                    ctx.beginPath();
                    ctx.moveTo(0, i);
                    ctx.lineTo(canvas.width, i);
                    ctx.stroke();
                }

                // Draw similarity lines from selected query to documents
                const query = queries[selectedQuery];
                documents.forEach(doc => {
                    const distance = Math.sqrt((query.pos.x - doc.pos.x) ** 2 + (query.pos.y - doc.pos.y) ** 2);
                    const alpha = doc.similarity;
                    
                    ctx.strokeStyle = `rgba(209, 76, 107, ${alpha})`;
                    ctx.lineWidth = 2 + (alpha * 3);
                    ctx.setLineDash([5, 5]);
                    ctx.beginPath();
                    ctx.moveTo(query.pos.x, query.pos.y);
                    ctx.lineTo(doc.pos.x, doc.pos.y);
                    ctx.stroke();
                });
                
                ctx.setLineDash([]);

                // Draw documents
                documents.forEach(doc => {
                    ctx.fillStyle = doc.similarity > 0.7 ? '#d14c6b' : doc.similarity > 0.2 ? '#3b82f6' : '#9ca3af';
                    ctx.beginPath();
                    ctx.arc(doc.pos.x, doc.pos.y, 8, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    // Draw similarity score
                    ctx.fillStyle = '#000';
                    ctx.font = '12px Arial';
                    ctx.fillText(doc.similarity.toFixed(2), doc.pos.x + 12, doc.pos.y - 10);
                });

                // Draw query
                ctx.fillStyle = query.color;
                ctx.beginPath();
                ctx.arc(query.pos.x, query.pos.y, 12, 0, 2 * Math.PI);
                ctx.fill();
                
                // Query label
                ctx.fillStyle = '#000';
                ctx.font = 'bold 14px Arial';
                ctx.fillText('Q', query.pos.x - 5, query.pos.y + 5);

            }, [selectedQuery, selectedPoint]);

            const handleCanvasClick = (event) => {
                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                
                // Check if clicked near any document
                let clickedDoc = null;
                documents.forEach(doc => {
                    const distance = Math.sqrt((x - doc.pos.x) ** 2 + (y - doc.pos.y) ** 2);
                    if (distance <= 12) {
                        clickedDoc = doc;
                    }
                });
                
                setSelectedPoint(clickedDoc);
            };

            return (
                <div className="w-full min-h-screen bg-gray-50 p-4">
                    <div className="max-w-6xl mx-auto">
                        <div className="text-center mb-6">
                            <h2 className="text-2xl font-bold mb-2 text-blue-900">Vector Similarity Visualization - 2D View</h2>
                            <p className="text-blue-800">Interactive demonstration of semantic similarity in vector space</p>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div className="lg:col-span-2 bg-white rounded-lg shadow-lg p-6">
                                <h3 className="text-lg font-semibold mb-4 text-blue-900">Vector Space</h3>
                                <canvas
                                    ref={canvasRef}
                                    width={500}
                                    height={400}
                                    className="border border-gray-300 rounded cursor-pointer w-full"
                                    onClick={handleCanvasClick}
                                />
                                <p className="text-sm text-gray-600 mt-2">Click on documents to see details. Lines show similarity strength.</p>
                            </div>

                            <div className="space-y-6">
                                <div className="bg-white rounded-lg shadow-lg p-6">
                                    <h3 className="text-lg font-semibold mb-4 text-blue-900">Query Selection</h3>
                                    <div className="space-y-2">
                                        {Object.entries(queries).map(([key, query]) => (
                                            <label key={key} className="flex items-center cursor-pointer">
                                                <input
                                                    type="radio"
                                                    name="query"
                                                    checked={selectedQuery === key}
                                                    onChange={() => setSelectedQuery(key)}
                                                    className="mr-3"
                                                />
                                                <span className="text-gray-700">"{query.text}"</span>
                                            </label>
                                        ))}
                                    </div>
                                </div>

                                {selectedPoint && (
                                    <div className="bg-white rounded-lg shadow-lg p-6">
                                        <h3 className="text-lg font-semibold mb-4 text-blue-900">Document Details</h3>
                                        <div className="space-y-2">
                                            <div className="text-sm text-gray-600">Document #{selectedPoint.id}</div>
                                            <div className="font-medium text-gray-900">"{selectedPoint.text}"</div>
                                            <div className="text-lg font-bold text-pink-600">
                                                Similarity: {selectedPoint.similarity.toFixed(3)}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                <div className="bg-white rounded-lg shadow-lg p-6">
                                    <h3 className="text-lg font-semibold mb-4 text-blue-900">Legend</h3>
                                    <div className="space-y-2 text-sm">
                                        <div className="flex items-center">
                                            <div className="w-4 h-4 bg-pink-600 rounded mr-2"></div>
                                            <span>High similarity (&gt; 0.7)</span>
                                        </div>
                                        <div className="flex items-center">
                                            <div className="w-4 h-4 bg-blue-500 rounded mr-2"></div>
                                            <span>Medium similarity (0.2-0.7)</span>
                                        </div>
                                        <div className="flex items-center">
                                            <div className="w-4 h-4 bg-gray-400 rounded mr-2"></div>
                                            <span>Low similarity (&lt; 0.2)</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // RAG PIPELINE VISUALIZER COMPONENT
        function RAGPipelineVisualizer() {
            const [currentStep, setCurrentStep] = useState(0);
            const [isRunning, setIsRunning] = useState(false);
            const [selectedQuery, setSelectedQuery] = useState('marriage_leave');
            const [showDetails, setShowDetails] = useState({});
            const [completedSteps, setCompletedSteps] = useState(new Set());

            const queries = {
                marriage_leave: {
                    text: "How many days of marriage leave do I get?",
                    embedding: [0.85, -0.23, 0.67, 0.12, -0.45, 0.78, 0.34, -0.56]
                },
                remote_work: {
                    text: "Can I work from home?",
                    embedding: [0.23, 0.67, -0.12, 0.89, 0.45, -0.34, 0.56, 0.78]
                },
                vacation_policy: {
                    text: "What is the vacation policy?",
                    embedding: [0.56, 0.34, 0.78, -0.23, 0.67, 0.12, -0.45, 0.89]
                }
            };

            const knowledgeBase = [
                {
                    id: "doc_1",
                    content: "Full-time employees are entitled to 4 working days of exceptional leave for their wedding. Part-time employees get 2 days.",
                    embedding: [0.82, -0.19, 0.71, 0.15, -0.42, 0.81, 0.31, -0.52],
                    similarity: 0.94
                },
                {
                    id: "doc_2", 
                    content: "Marriage leave must be requested 15 days in advance with proper documentation.",
                    embedding: [0.78, -0.25, 0.63, 0.18, -0.48, 0.75, 0.37, -0.59],
                    similarity: 0.89
                },
                {
                    id: "doc_3",
                    content: "Remote work policy allows up to 2 days per week from home with manager approval.",
                    embedding: [0.21, 0.69, -0.15, 0.91, 0.43, -0.31, 0.58, 0.76],
                    similarity: 0.12
                },
                {
                    id: "doc_4",
                    content: "Annual vacation is accrued at 2.5 days per month worked.",
                    embedding: [0.54, 0.32, 0.76, -0.21, 0.69, 0.14, -0.43, 0.87],
                    similarity: 0.23
                }
            ];

            const steps = [
                {
                    id: 'query',
                    title: 'User Query',
                    icon: MessageSquare,
                    description: 'User submits a natural language question',
                    color: 'bg-blue-500',
                    data: () => queries[selectedQuery].text
                },
                {
                    id: 'embedding',
                    title: 'Query Embedding',
                    icon: Zap,
                    description: 'Convert text to numerical vector representation',
                    color: 'bg-purple-500',
                    data: () => queries[selectedQuery].embedding
                },
                {
                    id: 'search',
                    title: 'Vector Search',
                    icon: Search,
                    description: 'Find similar documents using cosine similarity',
                    color: 'bg-green-500',
                    data: () => knowledgeBase.map(doc => ({
                        id: doc.id,
                        similarity: doc.similarity,
                        content: doc.content.substring(0, 50) + '...'
                    })).sort((a, b) => b.similarity - a.similarity)
                },
                {
                    id: 'retrieval',
                    title: 'Context Retrieval',
                    icon: Database,
                    description: 'Select top-K most relevant documents',
                    color: 'bg-orange-500',
                    data: () => knowledgeBase
                        .filter(doc => doc.similarity > 0.5)
                        .sort((a, b) => b.similarity - a.similarity)
                        .slice(0, 2)
                },
                {
                    id: 'llm',
                    title: 'LLM Processing',
                    icon: Brain,
                    description: 'Generate response using query + context',
                    color: 'bg-red-500',
                    data: () => ({
                        context: knowledgeBase.filter(doc => doc.similarity > 0.5).map(doc => doc.content).join(' '),
                        prompt: `Context: ${knowledgeBase.filter(doc => doc.similarity > 0.5).map(doc => doc.content).join(' ')}\n\nQuestion: ${queries[selectedQuery].text}\n\nAnswer:`
                    })
                },
                {
                    id: 'response',
                    title: 'Final Response',
                    icon: MessageSquare,
                    description: 'Generated answer based on retrieved context',
                    color: 'bg-indigo-500',
                    data: () => selectedQuery === 'marriage_leave' 
                        ? "Based on company policy, full-time employees are entitled to 4 working days of marriage leave, while part-time employees get 2 days. You need to request this leave 15 days in advance with proper documentation."
                        : selectedQuery === 'remote_work'
                        ? "According to the remote work policy, you can work from home up to 2 days per week with manager approval."
                        : "Annual vacation is accrued at a rate of 2.5 days per month worked."
                }
            ];

            const runPipeline = async () => {
                setIsRunning(true);
                setCurrentStep(0);
                setCompletedSteps(new Set());
                
                for (let i = 0; i <= steps.length - 1; i++) {
                    setCurrentStep(i);
                    setCompletedSteps(prev => new Set([...prev, i]));
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
                
                setIsRunning(false);
            };

            const resetPipeline = () => {
                setCurrentStep(0);
                setCompletedSteps(new Set());
                setIsRunning(false);
            };

            const toggleDetails = (stepId) => {
                setShowDetails(prev => ({
                    ...prev,
                    [stepId]: !prev[stepId]
                }));
            };

            const formatEmbedding = (embedding) => {
                return embedding.map(val => val.toFixed(3)).join(', ');
            };

            const renderStepData = (step, data) => {
                switch (step.id) {
                    case 'query':
                        return (
                            <div className="bg-blue-50 p-3 rounded border-l-4 border-blue-500">
                                <div className="font-medium text-blue-900">"{data}"</div>
                            </div>
                        );
                    
                    case 'embedding':
                        return (
                            <div className="bg-purple-50 p-3 rounded border-l-4 border-purple-500">
                                <div className="text-sm text-purple-800 mb-2">8-dimensional vector:</div>
                                <div className="font-mono text-xs bg-purple-100 p-2 rounded">
                                    [{formatEmbedding(data)}]
                                </div>
                            </div>
                        );
                    
                    case 'search':
                        return (
                            <div className="bg-green-50 p-3 rounded border-l-4 border-green-500">
                                <div className="text-sm text-green-800 mb-2">Similarity scores:</div>
                                <div className="space-y-1">
                                    {data.map((doc, idx) => (
                                        <div key={doc.id} className="flex justify-between text-xs">
                                            <span className="text-green-700">{doc.content}</span>
                                            <span className="font-bold text-green-600">{doc.similarity.toFixed(3)}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        );
                    
                    case 'retrieval':
                        return (
                            <div className="bg-orange-50 p-3 rounded border-l-4 border-orange-500">
                                <div className="text-sm text-orange-800 mb-2">Top-{data.length} retrieved documents:</div>
                                <div className="space-y-2">
                                    {data.map((doc, idx) => (
                                        <div key={doc.id} className="bg-orange-100 p-2 rounded">
                                            <div className="flex justify-between items-start mb-1">
                                                <span className="text-xs font-bold text-orange-600">#{idx + 1}</span>
                                                <span className="text-xs font-bold text-orange-600">{doc.similarity.toFixed(3)}</span>
                                            </div>
                                            <div className="text-xs text-orange-700">{doc.content}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        );
                    
                    case 'llm':
                        return (
                            <div className="bg-red-50 p-3 rounded border-l-4 border-red-500">
                                <div className="text-sm text-red-800 mb-2">LLM Input:</div>
                                <div className="bg-red-100 p-2 rounded text-xs text-red-700 max-h-24 overflow-y-auto">
                                    {data.prompt}
                                </div>
                            </div>
                        );
                    
                    case 'response':
                        return (
                            <div className="bg-indigo-50 p-3 rounded border-l-4 border-indigo-500">
                                <div className="text-sm text-indigo-800 mb-2">Generated Response:</div>
                                <div className="text-sm text-indigo-900 font-medium">"{data}"</div>
                            </div>
                        );
                    
                    default:
                        return null;
                }
            };

            return (
                <div className="w-full min-h-screen bg-gray-50 p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="text-center mb-8">
                            <h2 className="text-3xl font-bold mb-2 text-gray-900">RAG Pipeline Visualizer</h2>
                            <p className="text-gray-600">Interactive demonstration of the Retrieval-Augmented Generation process</p>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6 mb-8">
                            <div className="flex flex-col md:flex-row gap-6 items-start md:items-center justify-between">
                                <div className="flex-1">
                                    <h3 className="text-lg font-semibold mb-3 text-gray-900">Select Query</h3>
                                    <div className="space-y-2">
                                        {Object.entries(queries).map(([key, query]) => (
                                            <label key={key} className="flex items-center cursor-pointer">
                                                <input
                                                    type="radio"
                                                    name="query"
                                                    checked={selectedQuery === key}
                                                    onChange={() => setSelectedQuery(key)}
                                                    className="mr-3"
                                                    disabled={isRunning}
                                                />
                                                <span className="text-gray-700">"{query.text}"</span>
                                            </label>
                                        ))}
                                    </div>
                                </div>

                                <div className="flex gap-4">
                                    <button
                                        onClick={runPipeline}
                                        disabled={isRunning}
                                        className="flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                    >
                                        <Play className="w-5 h-5 mr-2" />
                                        {isRunning ? 'Running...' : 'Run Pipeline'}
                                    </button>
                                    
                                    <button
                                        onClick={resetPipeline}
                                        disabled={isRunning}
                                        className="flex items-center px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                    >
                                        <RotateCcw className="w-5 h-5 mr-2" />
                                        Reset
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-8">
                            <h3 className="text-xl font-semibold mb-6 text-gray-900">Pipeline Flow</h3>
                            
                            <div className="flex flex-wrap items-center justify-center gap-4 mb-8">
                                {steps.map((step, index) => {
                                    const StepIcon = step.icon;
                                    const isActive = currentStep === index;
                                    const isCompleted = completedSteps.has(index);
                                    
                                    return (
                                        <React.Fragment key={step.id}>
                                            <div className="flex flex-col items-center">
                                                <div className={`
                                                    w-16 h-16 rounded-full flex items-center justify-center text-white transition-all duration-500
                                                    ${isActive ? `${step.color} scale-110 shadow-lg` : 
                                                      isCompleted ? `${step.color}` : 'bg-gray-300'}
                                                `}>
                                                    <StepIcon className={`w-8 h-8 ${isActive ? 'animate-pulse' : ''}`} />
                                                </div>
                                                <div className="mt-2 text-center">
                                                    <div className="font-medium text-sm text-gray-900">{step.title}</div>
                                                    <div className="text-xs text-gray-600 max-w-24">{step.description}</div>
                                                </div>
                                            </div>
                                            
                                            {index < steps.length - 1 && (
                                                <ChevronRight className={`w-6 h-6 transition-colors duration-500 ${
                                                    isCompleted ? 'text-green-500' : 'text-gray-300'
                                                }`} />
                                            )}
                                        </React.Fragment>
                                    );
                                })}
                            </div>

                            <div className="space-y-6">
                                {steps.map((step, index) => {
                                    const isVisible = completedSteps.has(index) || currentStep === index;
                                    const stepData = isVisible ? step.data() : null;
                                    
                                    return (
                                        <div key={step.id} className={`
                                            transition-all duration-500 overflow-hidden
                                            ${isVisible ? 'opacity-100 max-h-96' : 'opacity-30 max-h-16'}
                                        `}>
                                            <div className="border border-gray-200 rounded-lg">
                                                <div 
                                                    className="p-4 cursor-pointer flex items-center justify-between bg-gray-50 hover:bg-gray-100 transition-colors"
                                                    onClick={() => toggleDetails(step.id)}
                                                >
                                                    <div className="flex items-center">
                                                        <div className={`w-8 h-8 rounded-full ${step.color} flex items-center justify-center text-white mr-3`}>
                                                            <step.icon className="w-4 h-4" />
                                                        </div>
                                                        <div>
                                                            <h4 className="font-semibold text-gray-900">{step.title}</h4>
                                                            <p className="text-sm text-gray-600">{step.description}</p>
                                                        </div>
                                                    </div>
                                                    
                                                    {isVisible && (
                                                        <button className="text-gray-500 hover:text-gray-700">
                                                            {showDetails[step.id] ? <EyeOff className="w-5 h-5" /> : <Eye className="w-5 h-5" />}
                                                        </button>
                                                    )}
                                                </div>
                                                
                                                {isVisible && showDetails[step.id] && stepData && (
                                                    <div className="p-4 border-t border-gray-200">
                                                        {renderStepData(step, stepData)}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // 3D EMBEDDINGS VISUALIZER COMPONENT
        function Embeddings3DVisualizer() {
            const mountRef = useRef(null);
            const sceneRef = useRef(null);
            const rendererRef = useRef(null);
            const frameIdRef = useRef(null);
            const [selectedPoint, setSelectedPoint] = useState(null);
            const [isRotating, setIsRotating] = useState(true);

            const documents = [
                { id: 1, text: "Marriage leave policy", pos: [2, 1, 0], color: 0xd14c6b, category: "HR" },
                { id: 2, text: "Wedding documentation", pos: [1.8, 1.2, -0.5], color: 0xd14c6b, category: "HR" },
                { id: 3, text: "Vacation policy", pos: [-1, 2, 1], color: 0x3b82f6, category: "HR" },
                { id: 4, text: "Remote work guidelines", pos: [0, -1, 2], color: 0x10b981, category: "Work" },
                { id: 5, text: "Office hours policy", pos: [0.5, -0.8, 1.8], color: 0x10b981, category: "Work" },
                { id: 6, text: "Parking regulations", pos: [-2, -1, -1], color: 0x9ca3af, category: "Facilities" },
                { id: 7, text: "Cafeteria menu", pos: [-1.8, -1.2, -0.8], color: 0x9ca3af, category: "Facilities" }
            ];

            useEffect(() => {
                if (!mountRef.current) return;

                // Scene setup
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0xf8fafc);
                sceneRef.current = scene;

                // Camera
                const camera = new THREE.PerspectiveCamera(75, 800 / 600, 0.1, 1000);
                camera.position.set(5, 5, 5);
                camera.lookAt(0, 0, 0);

                // Renderer
                const renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(800, 600);
                rendererRef.current = renderer;
                mountRef.current.appendChild(renderer.domElement);

                // Add axes
                const axesHelper = new THREE.AxesHelper(3);
                scene.add(axesHelper);

                // Add grid
                const gridHelper = new THREE.GridHelper(6, 10, 0x888888, 0xcccccc);
                scene.add(gridHelper);

                // Add documents as spheres
                documents.forEach(doc => {
                    const geometry = new THREE.SphereGeometry(0.1, 16, 16);
                    const material = new THREE.MeshBasicMaterial({ color: doc.color });
                    const sphere = new THREE.Mesh(geometry, material);
                    sphere.position.set(...doc.pos);
                    sphere.userData = doc;
                    scene.add(sphere);

                    // Add labels
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.width = 256;
                    canvas.height = 64;
                    context.fillStyle = 'white';
                    context.fillRect(0, 0, 256, 64);
                    context.fillStyle = 'black';
                    context.font = '16px Arial';
                    context.fillText(doc.text, 10, 40);

                    const texture = new THREE.CanvasTexture(canvas);
                    const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
                    const sprite = new THREE.Sprite(spriteMaterial);
                    sprite.position.set(doc.pos[0], doc.pos[1] + 0.3, doc.pos[2]);
                    sprite.scale.set(1, 0.25, 1);
                    scene.add(sprite);
                });

                // Add lighting
                const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
                scene.add(ambientLight);
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(10, 10, 5);
                scene.add(directionalLight);

                // Animation loop
                const animate = () => {
                    frameIdRef.current = requestAnimationFrame(animate);
                    
                    if (isRotating) {
                        camera.position.x = Math.cos(Date.now() * 0.001) * 7;
                        camera.position.z = Math.sin(Date.now() * 0.001) * 7;
                        camera.lookAt(0, 0, 0);
                    }
                    
                    renderer.render(scene, camera);
                };
                animate();

                // Cleanup
                return () => {
                    if (frameIdRef.current) {
                        cancelAnimationFrame(frameIdRef.current);
                    }
                    if (mountRef.current && renderer.domElement) {
                        mountRef.current.removeChild(renderer.domElement);
                    }
                    renderer.dispose();
                };
            }, [isRotating]);

            return (
                <div className="w-full min-h-screen bg-gray-50 p-4">
                    <div className="max-w-7xl mx-auto">
                        <div className="text-center mb-6">
                            <h2 className="text-2xl font-bold mb-2 text-blue-900">3D Embeddings Visualizer</h2>
                            <p className="text-blue-800">Explore document embeddings in 3D vector space</p>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            <div className="lg:col-span-3 bg-white rounded-lg shadow-lg p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-semibold text-blue-900">3D Vector Space</h3>
                                    <button
                                        onClick={() => setIsRotating(!isRotating)}
                                        className={`px-4 py-2 rounded-lg transition-colors ${
                                            isRotating ? 'bg-pink-600 text-white' : 'bg-gray-200 text-gray-700'
                                        }`}
                                    >
                                        {isRotating ? 'Stop Rotation' : 'Start Rotation'}
                                    </button>
                                </div>
                                <div ref={mountRef} className="flex justify-center"></div>
                                <p className="text-sm text-gray-600 mt-2">
                                    Documents with similar meanings cluster together in vector space.
                                </p>
                            </div>

                            <div className="space-y-6">
                                <div className="bg-white rounded-lg shadow-lg p-6">
                                    <h3 className="text-lg font-semibold mb-4 text-blue-900">Document Categories</h3>
                                    <div className="space-y-2">
                                        <div className="flex items-center">
                                            <div className="w-4 h-4 rounded mr-2" style={{backgroundColor: '#d14c6b'}}></div>
                                            <span className="text-sm">HR Policies</span>
                                        </div>
                                        <div className="flex items-center">
                                            <div className="w-4 h-4 rounded mr-2" style={{backgroundColor: '#3b82f6'}}></div>
                                            <span className="text-sm">Work Policies</span>
                                        </div>
                                        <div className="flex items-center">
                                            <div className="w-4 h-4 rounded mr-2" style={{backgroundColor: '#10b981'}}></div>
                                            <span className="text-sm">Work Guidelines</span>
                                        </div>
                                        <div className="flex items-center">
                                            <div className="w-4 h-4 rounded mr-2" style={{backgroundColor: '#9ca3af'}}></div>
                                            <span className="text-sm">Facilities</span>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white rounded-lg shadow-lg p-6">
                                    <h3 className="text-lg font-semibold mb-4 text-blue-900">Key Concepts</h3>
                                    <div className="space-y-3 text-sm text-gray-700">
                                        <div>
                                            <strong>Clustering:</strong> Similar documents appear close together in 3D space.
                                        </div>
                                        <div>
                                            <strong>Distance:</strong> Euclidean distance represents semantic similarity.
                                        </div>
                                        <div>
                                            <strong>Dimensions:</strong> Each axis represents a learned feature from the embedding model.
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white rounded-lg shadow-lg p-6">
                                    <h3 className="text-lg font-semibold mb-4 text-blue-900">Documents</h3>
                                    <div className="space-y-2">
                                        {documents.map(doc => (
                                            <div key={doc.id} className="flex items-center p-2 rounded hover:bg-gray-50">
                                                <div 
                                                    className="w-3 h-3 rounded-full mr-2" 
                                                    style={{backgroundColor: `#${doc.color.toString(16).padStart(6, '0')}`}}
                                                ></div>
                                                <span className="text-sm">{doc.text}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // MAIN APP COMPONENT
        function App() {
            const [activeTab, setActiveTab] = useState('topk');

            const tabs = [
                { id: 'topk', name: 'Top-K Simulator', component: TopKSimulator },
                { id: 'vector2d', name: 'Vector Similarity 2D', component: VectorSimilarity2D },
                { id: 'pipeline', name: 'RAG Pipeline', component: RAGPipelineVisualizer },
                { id: 'embeddings3d', name: '3D Embeddings', component: Embeddings3DVisualizer }
            ];

            const ActiveComponent = tabs.find(tab => tab.id === activeTab)?.component || TopKSimulator;

            return (
                <div className="min-h-screen bg-gray-100">
                    {/* Header */}
                    <div className="bg-white shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <h1 className="text-2xl font-bold text-gray-900 text-center">
                                RAG Training Tools - Interactive Demonstrations
                            </h1>
                            <p className="text-gray-600 text-center mt-2">
                                Comprehensive tools for understanding Retrieval-Augmented Generation
                            </p>
                        </div>
                    </div>

                    {/* Tab Navigation */}
                    <div className="bg-white border-b">
                        <div className="max-w-7xl mx-auto px-4">
                            <div className="flex space-x-8 overflow-x-auto">
                                {tabs.map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`py-4 px-2 border-b-2 font-medium text-sm whitespace-nowrap tab-button ${
                                            activeTab === tab.id
                                                ? 'border-pink-600 text-pink-600 active'
                                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                        }`}
                                    >
                                        {tab.name}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* Tab Content */}
                    <div className="tab-content active">
                        <ActiveComponent />
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
